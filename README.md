# Sirius-Jokers

### Описание
Это приложение поможет создавать и читать самые угарные анекдоты, например, <details> <summary>мой любимый анекдот про гвозди...</summary>

Мама сына в школу собирает, кладет хлеб, колбасу и гвозди, сын спрашивает:
- Мам, что это?
- Ну как, берёшь хлеб, кладёшь на него колбасу и ешь
- А гвозди?
- Так вот они

</details>

### Схема БД
Таблица ```users```
| Поле           | Тип                        | Описание                              |
| -------------- | -------------------------- | ------------------------------------- |
| id             | BIGSERIAL (PK)             | Уникальный идентификатор пользователя |
| username       | VARCHAR(30) UNIQUE         | Никнейм                               |
| display\_name  | VARCHAR(100)               | Отображаемое имя                      |
| email          | VARCHAR(255) UNIQUE        | Почта                                 |
| password\_hash | TEXT                       | Пароль (хэш)                          |
| created\_at    | TIMESTAMP WITH TZ          | Когда создан                          |
| last\_seen\_at | TIMESTAMP WITH TZ          | Последняя активность                  |
  
\
Таблица ```jokes```
| Поле        | Тип                             | Описание                              |
| ----------- | ------------------------------- | ------------------------------------- |
| id          | BIGSERIAL (PK)                  | ID анекдота                           |
| author\_id  | BIGINT (FK → users.id)          | Автор                                 |
| title       | VARCHAR(200)                    | Заголовок (опционально)               |
| body        | TEXT                            | Текст анекдота                        |
| language    | VARCHAR(10) DEFAULT 'ru'        | Язык                                  |
| score       | INT DEFAULT 0                   | Счётчик голосов (up-down)             |
| views       | BIGINT DEFAULT 0                | Кол-во просмотров                     |
| created\_at | TIMESTAMP WITH TZ               | Дата создания                         |
| updated\_at | TIMESTAMP WITH TZ               | Дата изменения                        |
  
\
Таблица ```favorites```
| Поле        | Тип                    | Описание        |
| ----------- | ---------------------- | --------------- |
| user\_id    | BIGINT (FK → users.id) | Пользователь    |
| joke\_id    | BIGINT (FK → jokes.id) | Избранная шутка |
| created\_at | TIMESTAMP WITH TZ      | Когда добавил   |

### Endpoints
```Auth```
| Метод | Путь               | Описание          | Тело запроса                                              | Ответ                                         |
| ----- | ------------------ | ----------------- | --------------------------------------------------------- | --------------------------------------------- |
| POST  | /api/auth/register | Регистрация       | `{ "username": "...", "email": "...", "password":"..." }` | `{ "id":1, "username":"...", "token":"..." }` |
| POST  | /api/auth/login    | Вход              | `{ "username":"...", "password":"..." }`                  | `{ "token":"...", "user":{...} }`             |
| GET   | /api/auth/me       | Инфо о себе (jwt) | —                                                         | `{ "id":1, "username":"..." }`                |
  
\
```Jokes```
| Метод  | Путь              | Описание                    | Тело запроса                      | Ответ                                    |
| ------ | ----------------- | --------------------------- | --------------------------------- | ---------------------------------------- |
| GET    | /api/jokes        | Список шуток (фильтр, сорт) | —                                 | `{ items:[...], page:1 }`                |
| GET    | /api/jokes/random | Случайная шутка             | —                                 | `{ id:1, body:"..." }`                   |
| GET    | /api/jokes/{id}   | Получить шутку              | —                                 | `{ id:1, body:"...", comments_count:2 }` |
| POST   | /api/jokes        | Создать шутку (авториз.)    | `{ "body":"...", "tags":["IT"] }` | `{ id:123 }`                             |
| PATCH  | /api/jokes/{id}   | Обновить шутку              | `{ "body":"..." }`                | `{ id:123, updated:true }`               |
| DELETE | /api/jokes/{id}   | Удалить (soft delete)       | —                                 | 204 No Content                           |

\
```Favorites```
| Метод  | Путь                      | Описание              | Тело запроса | Ответ              |
| ------ | ------------------------- | --------------------- | ------------ | ------------------ |
| POST   | /api/jokes/{id}/favorite  | Добавить в избранное  | —            | 201 Created        |
| DELETE | /api/jokes/{id}/favorite  | Удалить из избранного | —            | 204 No Content     |
| GET    | /api/users/{id}/favorites | Список избранного     | —            | `[ {...}, {...} ]` |


### Библиотеки
- express.js
- log4js
- dotenv
- Migrate
